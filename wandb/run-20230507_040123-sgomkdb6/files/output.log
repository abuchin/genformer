
global batch size: 32
WARNING:tensorflow:From /opt/conda/lib/python3.7/site-packages/tensorflow/python/autograph/pyct/static_analysis/liveness.py:83: Analyzer.lamba_check (from tensorflow.python.autograph.pyct.static_analysis.liveness) is deprecated and will be removed after 2023-09-23.
Instructions for updating:
Lambda fuctions will be no more assumed to be used in the statement where they are used, or at least in the same block. https://github.com/tensorflow/tensorflow/issues/56089
WARNING:tensorflow:From /opt/conda/lib/python3.7/site-packages/tensorflow/python/autograph/pyct/static_analysis/liveness.py:83: Analyzer.lamba_check (from tensorflow.python.autograph.pyct.static_analysis.liveness) is deprecated and will be removed after 2023-09-23.
Instructions for updating:
Lambda fuctions will be no more assumed to be used in the statement where they are used, or at least in the same block. https://github.com/tensorflow/tensorflow/issues/56089
created dataset iterators
{'BN_momentum': 0.9, 'atac_mask_dropout': 0.1, 'bce_loss_scale': 0.95, 'decay_frac': 0.5, 'dropout_rate': 0.05, 'epsilon': 1e-08, 'filter_list_atac': [32, 64], 'filter_list_seq': [512, 640, 768, 896, 1024, 1152], 'final_output_length': 1536, 'final_point_scale': 6, 'freeze_conv_layers': False, 'gradient_clip': 5, 'input_length': 262144, 'kernel_transformation': 'relu_kernel_transformation', 'learnable_PE': True, 'load_init': False, 'log_atac': True, 'lr_base1': 0.0002, 'lr_base2': 0.0002, 'num_heads': 8, 'num_random_features': 256, 'num_transformer_layers': 8, 'optimizer': 'adam', 'output_length': 2048, 'output_length_ATAC': 65536, 'output_res': 128, 'pointwise_dropout_rate': 0.1, 'random_mask_size': 768, 'rectify': True, 'seed': 24, 'sonnet_weights_bool': False, 'stable_variant': False, 'use_atac': True, 'use_seq': True, 'wd_1': 0.001, 'wd_2': 0.001, 'lr_base': 0.01, 'tpu': 'node-6', 'gcs_path': 'gs://picard-testing-176520/genformer_atac_pretrain/262k/genformer_atac_pretrain_globalacc_conv_rpgc_human', 'gcs_path_mm': 'gs://picard-testing-176520/genformer_atac_pretrain/262k/genformer_atac_pretrain_globalacc_conv_rpgc_mouse', 'gcs_path_rm': 'gs://picard-testing-176520/genformer_atac_pretrain/262k/genformer_atac_pretrain_globalacc_conv_rpgc_rhesus', 'gcs_path_rat': 'gs://picard-testing-176520/genformer_atac_pretrain/262k/genformer_atac_pretrain_globalacc_conv_rpgc_rat', 'gcs_path_holdout': 'gs://picard-testing-176520/genformer_atac_pretrain/262k/genformer_atac_pretrain_globalacc_conv_rpgc_val_holdout', 'num_epochs': 40, 'train_examples': 64, 'val_examples_ho': 64, 'batch_size': 4, 'warmup_frac': 0.025, 'patience': 50, 'min_delta': 5e-07, 'model_save_dir': 'gs://picard-testing-176520/genformer_atac_pretrain/models', 'model_save_basename': 'aformer', 'max_shift': 10, 'inits_type': 'enformer_conv', 'crop_size': 256, 'training_type': 'hg_mm_rm_rat', 'output_heads': ['human', 'mouse', 'rhesus', 'rat'], 'train_steps': 2, 'val_steps_ho': 3, 'total_steps': 2}
initialized model
building model
/opt/conda/lib/python3.7/site-packages/keras/initializers/initializers_v2.py:121: UserWarning: The initializer RandomUniform is unseeded and being called multiple times, which will return identical values  each time (even if the initializer is unseeded). Please update your code to provide a seed to the initializer, or avoid using the same initalizer instance more than once.
  f"The initializer {self.__class__.__name__} is unseeded "
total params: tf.Tensor(126440152, shape=(), dtype=int32)
starting epoch_ 1
WARNING:tensorflow:Gradients do not exist for variables ['aformer/dense_17/kernel:0', 'aformer/dense_17/bias:0', 'aformer/dense_19/kernel:0', 'aformer/dense_19/bias:0', 'aformer/dense_18/kernel:0', 'aformer/dense_18/bias:0', 'aformer/peaks_pool/dense_2/kernel:0', 'peaks_pool/dense/kernel:0', 'dense_21/kernel:0', 'dense_21/bias:0', 'peaks_pool/dense/kernel:0', 'dense_23/kernel:0', 'dense_23/bias:0', 'peaks_pool/dense/kernel:0', 'dense_22/kernel:0', 'dense_22/bias:0'] when minimizing the loss. If you're using `model.compile()`, did you forget to provide a `loss` argument?
WARNING:tensorflow:Gradients do not exist for variables ['aformer/dense_17/kernel:0', 'aformer/dense_17/bias:0', 'aformer/dense_19/kernel:0', 'aformer/dense_19/bias:0', 'aformer/dense_18/kernel:0', 'aformer/dense_18/bias:0', 'aformer/peaks_pool/dense_2/kernel:0', 'peaks_pool/dense/kernel:0', 'dense_21/kernel:0', 'dense_21/bias:0', 'peaks_pool/dense/kernel:0', 'dense_23/kernel:0', 'dense_23/bias:0', 'peaks_pool/dense/kernel:0', 'dense_22/kernel:0', 'dense_22/bias:0'] when minimizing the loss. If you're using `model.compile()`, did you forget to provide a `loss` argument?
WARNING:tensorflow:Gradients do not exist for variables ['aformer/dense_17/kernel:0', 'aformer/dense_17/bias:0', 'aformer/dense_19/kernel:0', 'aformer/dense_19/bias:0', 'aformer/dense_18/kernel:0', 'aformer/dense_18/bias:0', 'aformer/peaks_pool/dense_2/kernel:0', 'peaks_pool/dense/kernel:0', 'dense_21/kernel:0', 'dense_21/bias:0', 'peaks_pool/dense/kernel:0', 'dense_23/kernel:0', 'dense_23/bias:0', 'peaks_pool/dense/kernel:0', 'dense_22/kernel:0', 'dense_22/bias:0'] when minimizing the loss. If you're using `model.compile()`, did you forget to provide a `loss` argument?
WARNING:tensorflow:Gradients do not exist for variables ['aformer/dense_17/kernel:0', 'aformer/dense_17/bias:0', 'aformer/dense_19/kernel:0', 'aformer/dense_19/bias:0', 'aformer/dense_18/kernel:0', 'aformer/dense_18/bias:0', 'aformer/peaks_pool/dense_2/kernel:0', 'peaks_pool/dense/kernel:0', 'dense_21/kernel:0', 'dense_21/bias:0', 'peaks_pool/dense/kernel:0', 'dense_23/kernel:0', 'dense_23/bias:0', 'peaks_pool/dense/kernel:0', 'dense_22/kernel:0', 'dense_22/bias:0'] when minimizing the loss. If you're using `model.compile()`, did you forget to provide a `loss` argument?
WARNING:tensorflow:Gradients do not exist for variables ['aformer/dense_17/kernel:0', 'aformer/dense_17/bias:0', 'aformer/dense_19/kernel:0', 'aformer/dense_19/bias:0', 'aformer/dense_18/kernel:0', 'aformer/dense_18/bias:0', 'aformer/peaks_pool/dense_2/kernel:0', 'peaks_pool/dense/kernel:0', 'dense_21/kernel:0', 'dense_21/bias:0', 'peaks_pool/dense/kernel:0', 'dense_23/kernel:0', 'dense_23/bias:0', 'peaks_pool/dense/kernel:0', 'dense_22/kernel:0', 'dense_22/bias:0'] when minimizing the loss. If you're using `model.compile()`, did you forget to provide a `loss` argument?
WARNING:tensorflow:Gradients do not exist for variables ['aformer/dense_17/kernel:0', 'aformer/dense_17/bias:0', 'aformer/dense_19/kernel:0', 'aformer/dense_19/bias:0', 'aformer/dense_18/kernel:0', 'aformer/dense_18/bias:0', 'aformer/peaks_pool/dense_2/kernel:0', 'peaks_pool/dense/kernel:0', 'dense_21/kernel:0', 'dense_21/bias:0', 'peaks_pool/dense/kernel:0', 'dense_23/kernel:0', 'dense_23/bias:0', 'peaks_pool/dense/kernel:0', 'dense_22/kernel:0', 'dense_22/bias:0'] when minimizing the loss. If you're using `model.compile()`, did you forget to provide a `loss` argument?
WARNING:tensorflow:Gradients do not exist for variables ['aformer/dense_17/kernel:0', 'aformer/dense_17/bias:0', 'aformer/dense_19/kernel:0', 'aformer/dense_19/bias:0', 'aformer/dense_18/kernel:0', 'aformer/dense_18/bias:0', 'aformer/peaks_pool/dense_2/kernel:0', 'peaks_pool/dense/kernel:0', 'dense_21/kernel:0', 'dense_21/bias:0', 'peaks_pool/dense/kernel:0', 'dense_23/kernel:0', 'dense_23/bias:0', 'peaks_pool/dense/kernel:0', 'dense_22/kernel:0', 'dense_22/bias:0'] when minimizing the loss. If you're using `model.compile()`, did you forget to provide a `loss` argument?
WARNING:tensorflow:Gradients do not exist for variables ['aformer/dense_17/kernel:0', 'aformer/dense_17/bias:0', 'aformer/dense_19/kernel:0', 'aformer/dense_19/bias:0', 'aformer/dense_18/kernel:0', 'aformer/dense_18/bias:0', 'aformer/peaks_pool/dense_2/kernel:0', 'peaks_pool/dense/kernel:0', 'dense_21/kernel:0', 'dense_21/bias:0', 'peaks_pool/dense/kernel:0', 'dense_23/kernel:0', 'dense_23/bias:0', 'peaks_pool/dense/kernel:0', 'dense_22/kernel:0', 'dense_22/bias:0'] when minimizing the loss. If you're using `model.compile()`, did you forget to provide a `loss` argument?
WARNING:tensorflow:Gradients do not exist for variables ['aformer/dense_16/kernel:0', 'aformer/dense_16/bias:0', 'aformer/dense_19/kernel:0', 'aformer/dense_19/bias:0', 'aformer/dense_18/kernel:0', 'aformer/dense_18/bias:0', 'aformer/peaks_pool/dense_2/kernel:0', 'peaks_pool/dense/kernel:0', 'dense_20/kernel:0', 'dense_20/bias:0', 'peaks_pool/dense/kernel:0', 'dense_23/kernel:0', 'dense_23/bias:0', 'peaks_pool/dense/kernel:0', 'dense_22/kernel:0', 'dense_22/bias:0'] when minimizing the loss. If you're using `model.compile()`, did you forget to provide a `loss` argument?
WARNING:tensorflow:Gradients do not exist for variables ['aformer/dense_16/kernel:0', 'aformer/dense_16/bias:0', 'aformer/dense_19/kernel:0', 'aformer/dense_19/bias:0', 'aformer/dense_18/kernel:0', 'aformer/dense_18/bias:0', 'aformer/peaks_pool/dense_2/kernel:0', 'peaks_pool/dense/kernel:0', 'dense_20/kernel:0', 'dense_20/bias:0', 'peaks_pool/dense/kernel:0', 'dense_23/kernel:0', 'dense_23/bias:0', 'peaks_pool/dense/kernel:0', 'dense_22/kernel:0', 'dense_22/bias:0'] when minimizing the loss. If you're using `model.compile()`, did you forget to provide a `loss` argument?
WARNING:tensorflow:Gradients do not exist for variables ['aformer/dense_16/kernel:0', 'aformer/dense_16/bias:0', 'aformer/dense_19/kernel:0', 'aformer/dense_19/bias:0', 'aformer/dense_18/kernel:0', 'aformer/dense_18/bias:0', 'aformer/peaks_pool/dense_2/kernel:0', 'peaks_pool/dense/kernel:0', 'dense_20/kernel:0', 'dense_20/bias:0', 'peaks_pool/dense/kernel:0', 'dense_23/kernel:0', 'dense_23/bias:0', 'peaks_pool/dense/kernel:0', 'dense_22/kernel:0', 'dense_22/bias:0'] when minimizing the loss. If you're using `model.compile()`, did you forget to provide a `loss` argument?
WARNING:tensorflow:Gradients do not exist for variables ['aformer/dense_16/kernel:0', 'aformer/dense_16/bias:0', 'aformer/dense_19/kernel:0', 'aformer/dense_19/bias:0', 'aformer/dense_18/kernel:0', 'aformer/dense_18/bias:0', 'aformer/peaks_pool/dense_2/kernel:0', 'peaks_pool/dense/kernel:0', 'dense_20/kernel:0', 'dense_20/bias:0', 'peaks_pool/dense/kernel:0', 'dense_23/kernel:0', 'dense_23/bias:0', 'peaks_pool/dense/kernel:0', 'dense_22/kernel:0', 'dense_22/bias:0'] when minimizing the loss. If you're using `model.compile()`, did you forget to provide a `loss` argument?
WARNING:tensorflow:Gradients do not exist for variables ['aformer/dense_16/kernel:0', 'aformer/dense_16/bias:0', 'aformer/dense_17/kernel:0', 'aformer/dense_17/bias:0', 'aformer/dense_19/kernel:0', 'aformer/dense_19/bias:0', 'aformer/peaks_pool/dense_2/kernel:0', 'peaks_pool/dense/kernel:0', 'dense_20/kernel:0', 'dense_20/bias:0', 'peaks_pool/dense/kernel:0', 'dense_21/kernel:0', 'dense_21/bias:0', 'peaks_pool/dense/kernel:0', 'dense_23/kernel:0', 'dense_23/bias:0', 'peaks_pool/dense/kernel:0', 'dense_22/kernel:0', 'dense_22/bias:0'] when minimizing the loss. If you're using `model.compile()`, did you forget to provide a `loss` argument?
WARNING:tensorflow:Gradients do not exist for variables ['aformer/dense_16/kernel:0', 'aformer/dense_16/bias:0', 'aformer/dense_17/kernel:0', 'aformer/dense_17/bias:0', 'aformer/dense_19/kernel:0', 'aformer/dense_19/bias:0', 'aformer/peaks_pool/dense_2/kernel:0', 'peaks_pool/dense/kernel:0', 'dense_20/kernel:0', 'dense_20/bias:0', 'peaks_pool/dense/kernel:0', 'dense_21/kernel:0', 'dense_21/bias:0', 'peaks_pool/dense/kernel:0', 'dense_23/kernel:0', 'dense_23/bias:0', 'peaks_pool/dense/kernel:0', 'dense_22/kernel:0', 'dense_22/bias:0'] when minimizing the loss. If you're using `model.compile()`, did you forget to provide a `loss` argument?
WARNING:tensorflow:Gradients do not exist for variables ['aformer/dense_16/kernel:0', 'aformer/dense_16/bias:0', 'aformer/dense_17/kernel:0', 'aformer/dense_17/bias:0', 'aformer/dense_19/kernel:0', 'aformer/dense_19/bias:0', 'aformer/peaks_pool/dense_2/kernel:0', 'peaks_pool/dense/kernel:0', 'dense_20/kernel:0', 'dense_20/bias:0', 'peaks_pool/dense/kernel:0', 'dense_21/kernel:0', 'dense_21/bias:0', 'peaks_pool/dense/kernel:0', 'dense_23/kernel:0', 'dense_23/bias:0', 'peaks_pool/dense/kernel:0', 'dense_22/kernel:0', 'dense_22/bias:0'] when minimizing the loss. If you're using `model.compile()`, did you forget to provide a `loss` argument?
WARNING:tensorflow:Gradients do not exist for variables ['aformer/dense_16/kernel:0', 'aformer/dense_16/bias:0', 'aformer/dense_17/kernel:0', 'aformer/dense_17/bias:0', 'aformer/dense_19/kernel:0', 'aformer/dense_19/bias:0', 'aformer/peaks_pool/dense_2/kernel:0', 'peaks_pool/dense/kernel:0', 'dense_20/kernel:0', 'dense_20/bias:0', 'peaks_pool/dense/kernel:0', 'dense_21/kernel:0', 'dense_21/bias:0', 'peaks_pool/dense/kernel:0', 'dense_23/kernel:0', 'dense_23/bias:0', 'peaks_pool/dense/kernel:0', 'dense_22/kernel:0', 'dense_22/bias:0'] when minimizing the loss. If you're using `model.compile()`, did you forget to provide a `loss` argument?
WARNING:tensorflow:Gradients do not exist for variables ['aformer/dense_16/kernel:0', 'aformer/dense_16/bias:0', 'aformer/dense_17/kernel:0', 'aformer/dense_17/bias:0', 'aformer/dense_18/kernel:0', 'aformer/dense_18/bias:0', 'aformer/peaks_pool/dense_2/kernel:0', 'peaks_pool/dense/kernel:0', 'dense_20/kernel:0', 'dense_20/bias:0', 'peaks_pool/dense/kernel:0', 'dense_21/kernel:0', 'dense_21/bias:0', 'peaks_pool/dense/kernel:0', 'dense_22/kernel:0', 'dense_22/bias:0'] when minimizing the loss. If you're using `model.compile()`, did you forget to provide a `loss` argument?
WARNING:tensorflow:Gradients do not exist for variables ['aformer/dense_16/kernel:0', 'aformer/dense_16/bias:0', 'aformer/dense_17/kernel:0', 'aformer/dense_17/bias:0', 'aformer/dense_18/kernel:0', 'aformer/dense_18/bias:0', 'aformer/peaks_pool/dense_2/kernel:0', 'peaks_pool/dense/kernel:0', 'dense_20/kernel:0', 'dense_20/bias:0', 'peaks_pool/dense/kernel:0', 'dense_21/kernel:0', 'dense_21/bias:0', 'peaks_pool/dense/kernel:0', 'dense_22/kernel:0', 'dense_22/bias:0'] when minimizing the loss. If you're using `model.compile()`, did you forget to provide a `loss` argument?
WARNING:tensorflow:Gradients do not exist for variables ['aformer/dense_16/kernel:0', 'aformer/dense_16/bias:0', 'aformer/dense_17/kernel:0', 'aformer/dense_17/bias:0', 'aformer/dense_18/kernel:0', 'aformer/dense_18/bias:0', 'aformer/peaks_pool/dense_2/kernel:0', 'peaks_pool/dense/kernel:0', 'dense_20/kernel:0', 'dense_20/bias:0', 'peaks_pool/dense/kernel:0', 'dense_21/kernel:0', 'dense_21/bias:0', 'peaks_pool/dense/kernel:0', 'dense_22/kernel:0', 'dense_22/bias:0'] when minimizing the loss. If you're using `model.compile()`, did you forget to provide a `loss` argument?
WARNING:tensorflow:Gradients do not exist for variables ['aformer/dense_16/kernel:0', 'aformer/dense_16/bias:0', 'aformer/dense_17/kernel:0', 'aformer/dense_17/bias:0', 'aformer/dense_18/kernel:0', 'aformer/dense_18/bias:0', 'aformer/peaks_pool/dense_2/kernel:0', 'peaks_pool/dense/kernel:0', 'dense_20/kernel:0', 'dense_20/bias:0', 'peaks_pool/dense/kernel:0', 'dense_21/kernel:0', 'dense_21/bias:0', 'peaks_pool/dense/kernel:0', 'dense_22/kernel:0', 'dense_22/bias:0'] when minimizing the loss. If you're using `model.compile()`, did you forget to provide a `loss` argument?
WARNING:tensorflow:5 out of the last 5 calls to <function TPUExtended._tpu_function_creator.<locals>.tpu_function at 0x7eff55c6bb90> triggered tf.function retracing. Tracing is expensive and the excessive number of tracings could be due to (1) creating @tf.function repeatedly in a loop, (2) passing tensors with different shapes, (3) passing Python objects instead of tensors. For (1), please define your @tf.function outside of the loop. For (2), @tf.function has reduce_retracing=True option that can avoid unnecessary retracing. For (3), please refer to https://www.tensorflow.org/guide/function#controlling_retracing and https://www.tensorflow.org/api_docs/python/tf/function for  more details.
WARNING:tensorflow:5 out of the last 5 calls to <function TPUExtended._tpu_function_creator.<locals>.tpu_function at 0x7eff55c6bb90> triggered tf.function retracing. Tracing is expensive and the excessive number of tracings could be due to (1) creating @tf.function repeatedly in a loop, (2) passing tensors with different shapes, (3) passing Python objects instead of tensors. For (1), please define your @tf.function outside of the loop. For (2), @tf.function has reduce_retracing=True option that can avoid unnecessary retracing. For (3), please refer to https://www.tensorflow.org/guide/function#controlling_retracing and https://www.tensorflow.org/api_docs/python/tf/function for  more details.
train_loss_mm: 0.06285845
train_loss_rm: -0.00026537618
train_loss_rat: 0.014926992
train_loss: 0.052488033
completed epoch 1
training duration(mins): 9.219545491536458
WARNING:tensorflow:6 out of the last 10 calls to <function TPUExtended._tpu_function_creator.<locals>.tpu_function at 0x7effdc15e8c0> triggered tf.function retracing. Tracing is expensive and the excessive number of tracings could be due to (1) creating @tf.function repeatedly in a loop, (2) passing tensors with different shapes, (3) passing Python objects instead of tensors. For (1), please define your @tf.function outside of the loop. For (2), @tf.function has reduce_retracing=True option that can avoid unnecessary retracing. For (3), please refer to https://www.tensorflow.org/guide/function#controlling_retracing and https://www.tensorflow.org/api_docs/python/tf/function for  more details.
WARNING:tensorflow:6 out of the last 10 calls to <function TPUExtended._tpu_function_creator.<locals>.tpu_function at 0x7effdc15e8c0> triggered tf.function retracing. Tracing is expensive and the excessive number of tracings could be due to (1) creating @tf.function repeatedly in a loop, (2) passing tensors with different shapes, (3) passing Python objects instead of tensors. For (1), please define your @tf.function outside of the loop. For (2), @tf.function has reduce_retracing=True option that can avoid unnecessary retracing. For (3), please refer to https://www.tensorflow.org/guide/function#controlling_retracing and https://www.tensorflow.org/api_docs/python/tf/function for  more details.
val_loss: 0.05869478
val_loss_poisson: 0.045539428